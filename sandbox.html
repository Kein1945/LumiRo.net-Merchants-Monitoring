<!doctype html>
<html>
<head>
    <title>Sandboxed template renderer</title>
    <meta charset="utf-8">
    <script src="js/underscore-min.js" type="text/javascript"></script>
    <script src="js/utils.js" type="text/javascript"></script>
    <script type="text/javascript">
        var templates = {};
        window.addEventListener('message', function(event) {
            var template;

            if (typeof templates[event.data.templateName] == 'undefined') {
                template = _.template(event.data.template);
                templates[event.data.templateName] = template;
            } else {
                template = templates[event.data.templateName];
            }
            event.source.postMessage({
                id: event.data.id,
                result: template(event.data.context)
            }, event.origin);
        });
    </script>
</head>
<body>
</body>
</html>